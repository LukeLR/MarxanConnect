---
title: "Glossary"
output:
  html_document:
    keep_md: yes
    toc: yes
    toc_float: yes
bibliography: references.bib
---

```{r load packages,message=FALSE, warning=FALSE, echo=FALSE}
library(igraph)
library(tidyverse)
library(ggraph)
library(gganimate)
library(tidygraph)
library(RColorBrewer)
library(d3Network)
```

# Boundary Definitions

In Marxan, the boundary definitions (*i.e.* `boundary.dat`) in conjunction with the Boundary Length Modifier (BLM) can help achieve a solution with a reasonable edge to area ratio (*i.e.* minimize edge while still achieving representativity targets). Typically boundaries are numerically defined as the physical length of the shared boundary between planning units. Marxan Connect allows users to use boundary definitions to incorporate connectivity data (see @Beger2010-ir) and the BLM is then used as a Connectivity Strength Modifier. This encourages the selection of connected networks of protected areas and minimizes the effective "edge" of the network based on movement information.

Alternatively (or in conjunction), connectivity may be incorporated into the Marxan analysis by using [Conservation Features](glossary.html#conservation_feature).

## Connectivity as Boundary

Incorporates the connectivity data into the boundary definitions (*i.e.* `boundary.dat`; see @Beger2010-ir). 

## Minimum Planar Graph

Incorporates the connectivity data into the boundary definitions (*i.e.* `boundary.dat`) after transforming into a minimum planar graph (see @Fall2007-ku).


# Data Formats

Marxan Connect can accept different formats of connectivity data:

## Connectivity Matrix

We use a broad definition of connectivity matrix. The the donor site IDs are shown in the first column contains and the recipient site IDs in the first row. 

|     |   1   |   2   |   3   |   4   |  ...  |
|:---:|:-----:|:-----:|:-----:|:-----:|:-----:|
|**1**|  0.1  |  0.02 | 0.005 |  0.01 |  ...  |
|**2**| 0.006 |  0.2  | 0.007 | 0.009 |  ...  |
|**3**|  0.01 | 0.003 |  0.25 |  0.02 |  ...  |
|**4**| 0.022 | 0.017 | 0.001 |  0.2  |  ...  |
| ... |  ...  |  ...  |  ...  |  ...  |  ...  |

The cells contain information about the connectivity between those sites, but their exact value depends on whether the connectivity matrix is a [Probability](glossary.html#probability), a [Migration](glossary.html#migration), or a [Flow](glossary.html#flow) matrix

## Edge List

The first column contains the donor site IDs and second column contains the recipient site IDs. 

| id1 | id2 | value |
|:---:|:---:|:-----:|
|  1  |  1  |  0.1  |
|  1  |  2  |  0.02 |
|  1  |  3  | 0.005 |
|  1  |  4  |  0.01 |
| ... | ... |  ...  |

The value column contains information about the connectivity between those sites, but their exact value depends on whether the edge list is a [Probability](glossary.html#probability), a [Migration](glossary.html#migration), or a [Flow](glossary.html#flow) edge list

## Edge List with Time

The first column contains time, the second column contains the donor site IDs and the third column contains the recipient site IDs. 

| time | id1 | id2 | value |
|:----:|:---:|:---:|:-----:|
|   1  |  1  |  1  |  0.1  |
|   1  |  1  |  2  |  0.02 |
|   1  |  1  |  3  | 0.005 |
|   1  |  1  |  4  |  0.01 |
|  ... | ... | ... |  ...  |


The value column contain information about the connectivity between those sites at that particular time, but their exact value depends on whether the edge list is a [Probability](glossary.html#probability), a [Migration](glossary.html#migration), or a [Flow](glossary.html#flow) edge list

# Data Types

Marxan Connect can accept different types of connectivity data:

## Flow

Flow represents the amount (individuals, grams, etc) of <a href="" title="Genes, Organisms, Nutrients, Energy">GONE</a> (Genes, Organisms, Nutrients, Energy) that move from one planning unit to another. 

Example Flow Matrix:

|     |   1   |   2   |   3   |   4   |  ...  |
|:---:|:-----:|:-----:|:-----:|:-----:|:-----:|
|**1**|  1  |  2 | 5 |  1 |  ...  |
|**2**| 6 |  2  | 7 | 9 |  ...  |
|**3**|  1 | 3 |  3 |  2 |  ...  |
|**4**| 22 | 17 | 3 |  2  |  ...  |
| ... |  ...  |  ...  |  ...  |  ...  |  ...  |

## Migration

Migration represents the proportion of <a href="" title="Genes, Organisms, Nutrients, Energy">GONE</a> of those which arrive in a recipient planning unit originated in a donor planning unit. Columns sum to 1.

Example Flow Matrix:

|     |   1   |   2   |   3   |   4   |  ...  |
|:---:|:-----:|:-----:|:-----:|:-----:|:-----:|
|**1**|  0.1  |  0.02 | 0.005 |  0.01 |  ...  |
|**2**| 0.006 |  0.2  | 0.007 | 0.009 |  ...  |
|**3**|  0.01 | 0.003 |  0.25 |  0.02 |  ...  |
|**4**| 0.022 | 0.017 | 0.001 |  0.2  |  ...  |
| ... |  ...  |  ...  |  ...  |  ...  |  ...  |

## Probability

Probability represents the proportion of <a href="" title="Genes, Organisms, Nutrients, Energy">GONE</a> of those originating in a donor planning unit which arrive in a recipient planning unit. If there is no mortality, then rows sum to 1. 

Example Probability Matrix:

|     |   1   |   2   |   3   |   4   |  ...  |
|:---:|:-----:|:-----:|:-----:|:-----:|:-----:|
|**1**|  0.1  |  0.02 | 0.005 |  0.01 |  ...  |
|**2**| 0.006 |  0.2  | 0.007 | 0.009 |  ...  |
|**3**|  0.01 | 0.003 |  0.25 |  0.02 |  ...  |
|**4**| 0.022 | 0.017 | 0.001 |  0.2  |  ...  |
| ... |  ...  |  ...  |  ...  |  ...  |  ...  |

# Conservation Feature

Marxan Connect can calculate various connectivity metrics (e.g. centrality, outflow), which can be used as conservation features in Marxan. 

Alternatively (or in conjunction), connectivity may be incorporated into the Marxan analysis using [Boundary Definitions](glossary.html#boundary_definitions).

## In Degree

**Definition**: In degree indicates the number of connections into each planning unit [@Minor2007-fb].

**Objectives**: Prioritize planning units which receive input from a relative abundance of other planning units. The recipient planning units may have higher biodiversity (ref) and population resilience (ref) as a result of the high in degree.

**Equation**: The in degree of a planning unit ${v}$ (${ID(v)}$) in a graph ${G:=(V,E)}$ with ${V}$ vertices (*i.e.* planning units) and ${E}$ edges (*i.e.* connections).

$${\displaystyle ID(v) = deg^{-}(v)}$$

where ${deg^{-}(v)}$ is the number if inward pointing ${E}$ for planning unit ${v}$.

**Illustration**

```{r,message=FALSE, echo=FALSE, fig.width=5, fig.height = 5}
PU <- LETTERS[1:5]
AdjacencyMatrix <- matrix(data = c(FALSE,FALSE,FALSE,TRUE,FALSE,
                                   TRUE,FALSE,FALSE,FALSE,TRUE,
                                   TRUE,TRUE,FALSE,TRUE,TRUE,
                                   FALSE,TRUE,FALSE,FALSE,TRUE,
                                   FALSE,TRUE,FALSE,TRUE,FALSE),
                          nrow = 5,
                          ncol = 5,
                          dimnames = list(PU,PU))

G <- graph_from_adjacency_matrix(AdjacencyMatrix)
V(G)$metric <- igraph::degree(G,mode = "in")

ggraph(as_tbl_graph(G),layout="fr") + 
    geom_edge_fan(aes(alpha = ..index..), start_cap = circle(4, 'mm'), end_cap = circle(4, 'mm'), edge_width = 1.25) + 
    scale_edge_alpha('Edge direction', guide = 'edge_direction') +
    geom_node_point(aes(colour = metric),size = 8) + 
    scale_colour_gradientn(name="In Degree", colours = brewer.pal(5,"YlGnBu"),guide = guide_colorbar(barwidth=10)) +
    theme_void() + theme(legend.position="top",legend.box="vertical")
```

## Out Degree

**Definition**: Out degree indicates the number of connections originating from each planning unit [@Minor2007-fb].

**Objectives**: Prioritize for areas which deliver output to many other planning units. These planning units may influence many other planning units.

**Equation**: The in degree of a planning unit ${v}$ (${OD(v)}$) in a graph ${G:=(V,E)}$ with ${V}$ vertices (*i.e.* planning units) and ${E}$ edges (*i.e.* connections).

$${\displaystyle OD(v) = deg^{+}(v)}$$

where ${deg^{+}(v)}$ is the number of outward pointing ${E}$ for planning unit ${v}$.

**Illustration**

```{r,message=FALSE, echo=FALSE, fig.width=5, fig.height = 5}
PU <- LETTERS[1:5]
AdjacencyMatrix <- matrix(data = c(FALSE,FALSE,FALSE,TRUE,FALSE,
                                   TRUE,FALSE,FALSE,FALSE,TRUE,
                                   TRUE,TRUE,FALSE,TRUE,TRUE,
                                   FALSE,TRUE,FALSE,FALSE,TRUE,
                                   FALSE,TRUE,FALSE,TRUE,FALSE),
                          nrow = 5,
                          ncol = 5,
                          dimnames = list(PU,PU))

G <- graph_from_adjacency_matrix(AdjacencyMatrix)
V(G)$metric <- igraph::degree(G,mode = "out")

ggraph(as_tbl_graph(G),layout="fr") + 
    geom_edge_fan(aes(alpha = ..index..), start_cap = circle(4, 'mm'), end_cap = circle(4, 'mm'), edge_width = 1.25) + 
    scale_edge_alpha('Edge direction', guide = 'edge_direction') +
    geom_node_point(aes(colour = metric),size = 8) + 
    scale_colour_gradientn(name="Out Degree", colours = brewer.pal(5,"YlGnBu"),guide = guide_colorbar(barwidth=10)) +
    theme_void() + theme(legend.position="top",legend.box="vertical")
```

## Betweenness Centrality 

**Definition**: Betweenness centrality of a planning unit indicates the number of shortest paths between pairs of planning units that pass through that planning unit. It ignores the weights of each connection [@Minor2007-fb].

**Objectives**: Prioritize planning units which may act as critical stepping stones among other planning units.

**Equation**: The betweenness centrality of a planning unit ${v}$ (${BC(v)}$) in a graph ${G:=(V,E)}$ with ${V}$ vertices (*i.e.* planning units) and ${E}$ edges (*i.e.* connections) is

$$\displaystyle {BC(v)= \sum_{s \ne v \ne t \in V}\frac{{\sigma_{st}(v)}}{\sigma_{st}}}$$

where ${\sigma _{st}}$ is total number of shortest paths from planning unit ${s}$ to planning unit ${t}$ and ${\sigma _{st}(v)}$ is the number of those paths that pass through ${v}$.

**Illustration**

```{r,message=FALSE, echo=FALSE, fig.width=5, fig.height = 5}
PU <- LETTERS[1:5]
AdjacencyMatrix <- matrix(data = c(FALSE,FALSE,FALSE,TRUE,FALSE,
                                   TRUE,FALSE,FALSE,FALSE,TRUE,
                                   TRUE,TRUE,FALSE,TRUE,TRUE,
                                   FALSE,TRUE,FALSE,FALSE,TRUE,
                                   FALSE,TRUE,FALSE,TRUE,FALSE),
                          nrow = 5,
                          ncol = 5,
                          dimnames = list(PU,PU))

G <- graph_from_adjacency_matrix(AdjacencyMatrix)
V(G)$metric <- igraph::betweenness(G)

ggraph(as_tbl_graph(G),layout="fr") + 
    geom_edge_fan(aes(alpha = ..index..), start_cap = circle(4, 'mm'), end_cap = circle(4, 'mm'), edge_width = 1.25) + 
    scale_edge_alpha('Edge direction', guide = 'edge_direction') +
    geom_node_point(aes(colour = metric),size = 8) + 
    scale_colour_gradientn(name="Betweenness Centrality", colours = brewer.pal(5,"YlGnBu"),guide = guide_colorbar(barwidth=10)) +
    theme_void() + theme(legend.position="top",legend.box="vertical")
```

## Eigenvector Centrality

**Definition**: Eigenvector centrality indicates the influence (considers number of connections and their weight) that a planning unit has on the network [@DAloia2017-jp]. Eigenvector centrality is functionally similar to [Google PageRank]("glossary.html#google_pagerank"), and is recommended for well connected planning areas.

**Objectives**: Prioritize planning units which are important to maintaining connectivity within the whole planning area.

**Equation**: The Eigenvector centrality of a planning unit ${v}$ (${EVC(v)}$) in a graph ${G:=(V,E)}$ with ${V}$ vertices (*i.e.* planning units) and ${E}$ edges (*i.e.* connections), let ${C=(c_{v,t})}$ be the connectivity (migration) matrix

$${\displaystyle EVC(v) =  \frac{1}{\lambda} \sum_{t \in G} c_{v,t}}$$

where ${\lambda }$ is the leading eigenvalue.

**Illustration**

```{r,message=FALSE, warning=FALSE, echo=FALSE, fig.width=5, fig.height = 6}
PU <- LETTERS[1:5]
AdjacencyMatrix <- matrix(data = c(0,0,0,0.01,0,
                                   0.1,0,0,0,0.1,
                                   0.01,0.05,0,0.01,0.01,
                                   0,0.01,0,0,0.05,
                                   0,0.1,0,0.1,0),
                          nrow = 5,
                          ncol = 5,
                          dimnames = list(PU,PU))

G <- graph_from_adjacency_matrix(AdjacencyMatrix, weighted=TRUE)
V(G)$metric <- igraph::eigen_centrality(G,directed = TRUE)$vector

ggraph(as_tbl_graph(G),layout="fr") + 
    geom_edge_fan(aes(colour=weight,alpha = ..index..), start_cap = circle(4, 'mm'), end_cap = circle(4, 'mm'), edge_width = 1.25) + 
    scale_edge_colour_gradientn("Weight",colours=brewer.pal(5,"PuRd"),guide = guide_edge_colourbar(barwidth = 10))+
    scale_edge_alpha('Edge direction', guide = 'edge_direction') +
    geom_node_point(aes(colour = metric),size = 8) + 
    scale_colour_gradientn(name="Eigenvector Centrality", colours = brewer.pal(5,"YlGnBu"),guide = guide_colorbar(barwidth=10)) +
    theme_void() + theme(legend.position="top",legend.box="vertical")
```

## Google PageRank

**Definition**: PageRank indicates the number and quality (weight) of connections to a planning unit which represents an estimated importance of the planning unit. PageRank is functionally similar to [Eigenvector Centrality]("glossary.html#google_pagerank"), and is recommended for sparsely connected planning areas.

**Objectives**: Prioritize planning units which are important to maintaining connectivity within the whole study area.

**Equation**: The weighted PageRank of a planning unit ${v}$ (${PR(v)}$) in a graph ${G:=(V,E)}$ with ${V}$ vertices (*i.e.* planning units) and ${E}$ edges (*i.e.* connections), let ${C=(c_{v,t})}$ be the connectivity (probability? migration?) matrix.

$$\displaystyle PR(v) = 1-d+d\sum_{v\ne t\in V}PR(t)c_{v,t}c_{t,v}$$

where $d$ is the damping factor set to 0.85 by default.

**Illustration**

```{r,message=FALSE, warning=FALSE, echo=FALSE, fig.width=5, fig.height = 6}
PU <- LETTERS[1:5]
AdjacencyMatrix <- matrix(data = c(0,0,0,0.01,0,
                                   0.1,0,0,0,0.1,
                                   0.01,0.05,0,0.01,0.01,
                                   0,0.01,0,0,0.05,
                                   0,0.1,0,0.1,0),
                          nrow = 5,
                          ncol = 5,
                          dimnames = list(PU,PU))

G <- graph_from_adjacency_matrix(AdjacencyMatrix, weighted=TRUE)
V(G)$metric <- igraph::page.rank(G,directed = TRUE)$vector

ggraph(as_tbl_graph(G),layout="fr") + 
    geom_edge_fan(aes(colour=weight,alpha = ..index..), start_cap = circle(4, 'mm'), end_cap = circle(4, 'mm'), edge_width = 1.25) + 
    scale_edge_colour_gradientn("Weight",colours=brewer.pal(5,"PuRd"),guide = guide_edge_colourbar(barwidth = 10))+
    scale_edge_alpha('Edge direction', guide = 'edge_direction') +
    geom_node_point(aes(colour = metric),size = 8) + 
    scale_colour_gradientn(name="PageRank", colours = brewer.pal(5,"YlGnBu"),guide = guide_colorbar(barwidth=10)) +
    theme_void() + theme(legend.position="top",legend.box="vertical")
```

## Self Recruitment

**Definition**: Self recruitment indicates the proportion of recruits produced in a planning unit relative to all recruits to that planning unit [@DAloia2017-jp].

**Objectives**: Prioritize planning units which are more self-sustaining.

**Equation**: The self recruitment of a planning unit ${v}$ (${SR(v)}$) in a graph ${G:=(V,E)}$ with ${V}$ vertices (*i.e.* planning units) and ${E}$ edges (*i.e.* connections), let ${C=(c_{v,t})}$ be the connectivity (probability) matrix.

$${\displaystyle SR(v) = \frac{c_{v,v}N_v}{\sum_{t \in V}c_{t,v}N_v}}$$

where ${N_v}$ is the number of potential recruits produced in planning unit ${t}$.

**Illustration**

```{r,message=FALSE, warning=FALSE, echo=FALSE, fig.width=5, fig.height=6}
PU <- LETTERS[1:5]
AdjacencyMatrix <- matrix(data = c(0,0,0,0,0,
                                   0,0.1,0,0,0,
                                   0,0,0.05,0,0,
                                   0,0,0,0.001,0,
                                   0,0,0,0,0.001),
                          nrow = 5,
                          ncol = 5,
                          dimnames = list(PU,PU))

G <- graph_from_adjacency_matrix(AdjacencyMatrix, weighted=TRUE)
V(G)$metric <- diag(AdjacencyMatrix)

ggraph(as_tbl_graph(G),layout="fr") + 
    geom_edge_loop(aes(colour=weight,alpha = ..index..), start_cap = circle(4, 'mm'), end_cap = circle(4, 'mm'), edge_width = 1.25) + 
    scale_edge_colour_gradientn("Weight",colours=brewer.pal(5,"PuRd"),guide = guide_edge_colourbar(barwidth = 10))+
    scale_edge_alpha('Edge direction', guide = 'edge_direction') +
    geom_node_point(aes(colour = metric),size = 8) + 
    scale_colour_gradientn(name="Self Recruitment", colours = brewer.pal(5,"YlGnBu"),guide = guide_colorbar(barwidth=10)) +
    theme_void() + theme(legend.position="top",legend.box="vertical")
```

## Local Retention

**Definition**: Local retention indicates the proportion of potential recruits produced in a planning unit which are retained within that planning unit. 

**Objectives**: Prioritize planning units which are relatively self-sustaining.

**Equation**: The local retention of a planning unit ${v}$ (${LR(v)}$) in a graph ${G:=(V,E)}$ with ${V}$ vertices (*i.e.* planning units) and ${E}$ edges (*i.e.* connections), let ${C=(c_{v,t})}$ be the connectivity (probability) matrix.

$$\displaystyle LR(v) = c_{v,v}$$

**Illustration**

```{r,message=FALSE, warning=FALSE, echo=FALSE, fig.width=5, fig.height=6}
PU <- LETTERS[1:5]
AdjacencyMatrix <- matrix(data = c(0,0,0,0,0,
                                   0,0.1,0,0,0,
                                   0,0,0.05,0,0,
                                   0,0,0,0.001,0,
                                   0,0,0,0,0.001),
                          nrow = 5,
                          ncol = 5,
                          dimnames = list(PU,PU))

G <- graph_from_adjacency_matrix(AdjacencyMatrix, weighted=TRUE)
V(G)$metric <- diag(AdjacencyMatrix)

ggraph(as_tbl_graph(G),layout="fr") + 
    geom_edge_loop(aes(colour=weight,alpha = ..index..), start_cap = circle(4, 'mm'), end_cap = circle(4, 'mm'), edge_width = 1.25) + 
    scale_edge_colour_gradientn("Weight",colours=brewer.pal(5,"PuRd"),guide = guide_edge_colourbar(barwidth = 10))+
    scale_edge_alpha('Edge direction', guide = 'edge_direction') +
    geom_node_point(aes(colour = metric),size = 8) + 
    scale_colour_gradientn(name="Local Retention", colours = brewer.pal(5,"YlGnBu"),guide = guide_colorbar(barwidth=10)) +
    theme_void() + theme(legend.position="top",legend.box="vertical")
```

## Inflow

**Definition**: Inflow indicates the amount of <a href="" title="Genes, Organisms, Nutrients, Energy">GONE</a> arriving into a planning unit.

**Objectives**: Prioritize planning units which are heavily subsidized by other planning units.

**Equation**: The inflow of a planning unit ${v}$ (${IF(v)}$) in a graph ${G:=(V,E)}$ with ${V}$ vertices (*i.e.* planning units) and ${E}$ edges (*i.e.* connections), let ${C=(c_{v,t})}$ be the connectivity (probability) matrix.

$${\displaystyle IF(v) = \sum_{t \ne v \in V}c_{t,v}N_t}$$

where ${N_t}$ is the number of potential recruits produced in planning unit ${t}$.

**Illustration**

```{r,message=FALSE, warning=FALSE, echo=FALSE, fig.width=5, fig.height = 6}
PU <- LETTERS[1:5]
AdjacencyMatrix <- matrix(data = c(0,0,0,0.01,0,
                                   0.1,0,0,0,0.1,
                                   0.01,0.05,0,0.01,0.01,
                                   0,0.01,0,0,0.05,
                                   0,0.1,0,0.1,0),
                          nrow = 5,
                          ncol = 5,
                          dimnames = list(PU,PU))

G <- graph_from_adjacency_matrix(AdjacencyMatrix, weighted=TRUE)
diag(AdjacencyMatrix) <- 0
V(G)$metric <- colSums(AdjacencyMatrix)

ggraph(as_tbl_graph(G),layout="fr") + 
    geom_edge_fan(aes(colour=weight,alpha = ..index..), start_cap = circle(4, 'mm'), end_cap = circle(4, 'mm'), edge_width = 1.25) + 
    scale_edge_colour_gradientn("Flow Weight",colours=brewer.pal(5,"PuRd"),guide = guide_edge_colourbar(barwidth = 10))+
    scale_edge_alpha('Edge direction', guide = 'edge_direction') +
    geom_node_point(aes(colour = metric),size = 8) + 
    scale_colour_gradientn(name="Inflow", colours = brewer.pal(5,"YlGnBu"),guide = guide_colorbar(barwidth=10)) +
    theme_void() + theme(legend.position="top",legend.box="vertical")
```

## Outflow

**Definition**: The outflow indicates the amount of <a href="" title="Genes, Organisms, Nutrients, Energy">GONE</a> leaving a planning unit.

**Objectives**: Prioritize planning units which subsidize other planning units (e.g. maximize spillover).

**Equation**: The inflow of a planning unit ${v}$ (${OF(v)}$) in a graph ${G:=(V,E)}$ with ${V}$ vertices (*i.e.* planning units) and ${E}$ edges (*i.e.* connections), let ${C=(c_{v,t})}$ be the connectivity (probability) matrix.

$${\displaystyle OF(v) = \sum_{t \ne v \in V}c_{v,t}N_v}$$

where ${N_v}$ is the number of potential recruits produced in planning unit ${v}$.

**Illustration**

```{r,message=FALSE, warning=FALSE, echo=FALSE, fig.width=5, fig.height = 6}
PU <- LETTERS[1:5]
AdjacencyMatrix <- matrix(data = c(0,0,0,0.01,0,
                                   0.1,0,0,0,0.1,
                                   0.01,0.05,0,0.01,0.01,
                                   0,0.01,0,0,0.05,
                                   0,0.1,0,0.1,0),
                          nrow = 5,
                          ncol = 5,
                          dimnames = list(PU,PU))

G <- graph_from_adjacency_matrix(AdjacencyMatrix, weighted=TRUE)
diag(AdjacencyMatrix) <- 0
V(G)$metric <- rowSums(AdjacencyMatrix)

ggraph(as_tbl_graph(G),layout="fr") + 
    geom_edge_fan(aes(colour=weight,alpha = ..index..), start_cap = circle(4, 'mm'), end_cap = circle(4, 'mm'), edge_width = 1.25) + 
    scale_edge_colour_gradientn("Flow Weight",colours=brewer.pal(5,"PuRd"),guide = guide_edge_colourbar(barwidth = 10))+
    scale_edge_alpha('Edge direction', guide = 'edge_direction') +
    geom_node_point(aes(colour = metric),size = 8) + 
    scale_colour_gradientn(name="Outflow", colours = brewer.pal(5,"YlGnBu"),guide = guide_colorbar(barwidth=10)) +
    theme_void() + theme(legend.position="top",legend.box="vertical")
```

## Temporal Connectivity Covariance

**Definition**: Temporal connectivity covariance indicates the temporal complementarity (*i.e.* negative covariance) of connections from a planning unit to the focus areas to existing connections within the focus area [@Watson2012-ug].

The option to calculate it is only available if a connectivity 'List with Time' was provided under Demographic Input in the Connectivity Input tab, and a focus area shapefile was provided under the Spatial Input tab.

*Warning: This metric is still experimental 'beta' phase*

**Objectives**: Prioritize planning units which increase focus area metapopulation growth and stability.


**Equation**: The temporal connectivity covariance of a planning unit ${v}$ (${TCC(v)}$) in a graph ${G:=(V,E)}$ with ${V}$ vertices (*i.e.* planning units) and ${E}$ edges (*i.e.* connections), let ${A=(a_{v,t})}$ be the adjacency matrix

$${\displaystyle TCC(v) = -\sum_{i \in E_{v,FA}} \sum_{j \in E_{FA,FA}}Cov(E_i,E_j)}$$

where ${E_{FA,FA}}$ are the ${E}$ that link 2 planning units, both of which spatially overlap with the focus area, ${E_{v,FA}}$ are the ${E}$ that originate in ${v}$ and end in a planning unit which spatially overlaps with the focus area, and ${Cov()}$ is the temporal covariance.

**Illustration**

```{r,message=FALSE, warning=FALSE, echo=FALSE, fig.width=5, fig.height = 6}
PU <- LETTERS[1:5]
AdjacencyMatrix1 <- matrix(data = c(0,0,0,0.01,0,
                                   0.1,0,0,0,0.1,
                                   0.01,0.05,0,0.01,0.01,
                                   0,0.01,0,0,0.05,
                                   0,0.1,0,0.1,0),
                          nrow = 5,
                          ncol = 5,
                          dimnames = list(PU,PU))

AdjacencyMatrix2 <- matrix(data = c(0,0,0,0.1,0,
                                   0.01,0,0,0,0.01,
                                   0.1,0.05,0,0.01,0.1,
                                   0,0.1,0,0,0.5,
                                   0,0.01,0,0.01,0),
                          nrow = 5,
                          ncol = 5,
                          dimnames = list(PU,PU))

AdjacencyMatrix3 <- matrix(data = c(0,0,0,0.01,0,
                                   0.1,0,0,0,0.1,
                                   0.01,0.015,0,0.01,0.01,
                                   0,0.01,0,0,0.05,
                                   0,0.1,0,0.1,0),
                          nrow = 5,
                          ncol = 5,
                          dimnames = list(PU,PU))

G1 <- graph_from_adjacency_matrix(AdjacencyMatrix1, weighted=TRUE)
E(G1)$year <- "Year 1"
V(G1)$type <- c("Planning Unit","Focus Area","Planning Unit","Focus Area","Planning Unit")
G2 <- graph_from_adjacency_matrix(AdjacencyMatrix2, weighted=TRUE)
E(G2)$year <- "Year 2"
G3 <- graph_from_adjacency_matrix(AdjacencyMatrix3, weighted=TRUE)
E(G3)$year <- "Year 3"
G4 <- graph_from_adjacency_matrix(AdjacencyMatrix2, weighted=TRUE)
E(G4)$year <- "Year 4"

graph <- graph_join(graph_join(as_tbl_graph(G1),as_tbl_graph(G2),by="name"),graph_join(as_tbl_graph(G3),as_tbl_graph(G4),by="name"),by="name")

p <- ggraph(graph,layout="fr") + 
    geom_edge_fan(aes(colour=weight,alpha = ..index..,frame=year), start_cap = circle(4, 'mm'), end_cap = circle(4, 'mm'), edge_width = 1.25) + 
    scale_edge_colour_gradientn("Weight",colours=brewer.pal(5,"PuRd"),guide = guide_edge_colourbar(barwidth = 10))+
    scale_edge_alpha('Edge direction', guide = 'edge_direction') +
    geom_node_point(aes(shape=type),size = 8) + 
    scale_shape(name="")+
    scale_colour_gradientn(name="Avoidance Area Donors", colours = brewer.pal(5,"YlGnBu"),guide = guide_colorbar(barwidth=10)) +
    theme_void() + theme(legend.position="top",legend.box="vertical")
gganimate(p,"images/temporalconnectivity.gif")
```

![](images/temporalconnectivity.gif)

## Focus Area Recipients

**Definition**: The focus area recipients indicates the amount of <a href="" title="Genes, Organisms, Nutrients, Energy">GONE</a> coming into planning units from the focus area.

**Objectives**: Prioritize planning units which are subsidized by the focus area.

**Equation**: The focus area recipients of a planning unit ${v}$ (${FAR(v)}$) in a graph ${G:=(V,E)}$ with ${V}$ vertices (*i.e.* planning units) and ${E}$ edges (*i.e.* connections), let ${C=(c_{v,t})}$ be the connectivity (probability) matrix.

$${\displaystyle FAR(v) = \sum_{t \ne v \in V(FA)}c_{t,v}N_t}$$

where ${N_t}$ is the amount of <a href="" title="Genes, Organisms, Nutrients, Energy">GONE</a> produced in planning unit ${t}$ and ${V(FA)}$ are the ${V}$ which spatially overlap with the focus area.

**Illustration**

```{r,message=FALSE, warning=FALSE, echo=FALSE, fig.width=5, fig.height = 6}
PU <- LETTERS[1:5]
AdjacencyMatrix <- matrix(data = c(0,0,0,0.01,0,
                                   0.1,0,0,0,0.1,
                                   0.01,0.05,0,0.01,0.01,
                                   0,0.01,0,0,0.05,
                                   0,0.1,0,0.1,0),
                          nrow = 5,
                          ncol = 5,
                          dimnames = list(PU,PU))

G <- graph_from_adjacency_matrix(AdjacencyMatrix, weighted=TRUE)
V(G)$type <- c("Planning Unit","Focus Area","Planning Unit","Focus Area","Planning Unit")

V(G)$metric <- colSums(AdjacencyMatrix[V(G)$type=="Focus Area",])

ggraph(as_tbl_graph(G),layout="fr") + 
    geom_edge_fan(aes(colour=weight,alpha = ..index..), start_cap = circle(4, 'mm'), end_cap = circle(4, 'mm'), edge_width = 1.25) + 
    scale_edge_colour_gradientn("Weight",colours=brewer.pal(5,"PuRd"),guide = guide_edge_colourbar(barwidth = 10))+
    scale_edge_alpha('Edge direction', guide = 'edge_direction') +
    geom_node_point(aes(colour = metric,shape=type),size = 8) + 
    scale_shape(name="")+
    scale_colour_gradientn(name="Focus Area Recipient", colours = brewer.pal(5,"YlGnBu"),guide = guide_colorbar(barwidth=10)) +
    theme_void() + theme(legend.position="top",legend.box="vertical")
```

## Focus Area Donors

**Definition**: Focus area donors indicates the amount of <a href="" title="Genes, Organisms, Nutrients, Energy">GONE</a> arriving into the focus area from planning units.

**Objectives**: Prioritize planning units which subsidize the focus area (e.g. protect demographic sources to existing protected areas).

**Equation**: The focus area donors of a planning unit ${v}$ (${FAD(v)}$) in a graph ${G:=(V,E)}$ with ${V}$ vertices (*i.e.* planning units) and ${E}$ edges (*i.e.* connections), let ${C=(c_{v,t})}$ be the connectivity (probability) matrix.

$${\displaystyle FAD(v) = \sum_{t \ne v \in V(FA)}c_{v,t}N_v}$$

where ${N_v}$ is the amount of <a href="" title="Genes, Organisms, Nutrients, Energy">GONE</a> produced in planning unit ${v}$ and ${V(FA)}$ are the ${V}$ which spatially overlap with the focus area.

**Illustration**

```{r,message=FALSE, warning=FALSE, echo=FALSE, fig.width=5, fig.height = 6}
PU <- LETTERS[1:5]
AdjacencyMatrix <- matrix(data = c(0,0,0,0.01,0,
                                   0.1,0,0,0,0.1,
                                   0.01,0.05,0,0.01,0.01,
                                   0,0.01,0,0,0.05,
                                   0,0.1,0,0.1,0),
                          nrow = 5,
                          ncol = 5,
                          dimnames = list(PU,PU))

G <- graph_from_adjacency_matrix(AdjacencyMatrix, weighted=TRUE)
V(G)$type <- c("Planning Unit","Focus Area","Planning Unit","Focus Area","Planning Unit")

V(G)$metric <- rowSums(AdjacencyMatrix[,V(G)$type=="Focus Area"])

ggraph(as_tbl_graph(G),layout="fr") + 
    geom_edge_fan(aes(colour=weight,alpha = ..index..), start_cap = circle(4, 'mm'), end_cap = circle(4, 'mm'), edge_width = 1.25) + 
    scale_edge_colour_gradientn("Weight",colours=brewer.pal(5,"PuRd"),guide = guide_edge_colourbar(barwidth = 10))+
    scale_edge_alpha('Edge direction', guide = 'edge_direction') +
    geom_node_point(aes(colour = metric,shape=type),size = 8) + 
    scale_shape(name="")+
    scale_colour_gradientn(name="Focus Area Donors", colours = brewer.pal(5,"YlGnBu"),guide = guide_colorbar(barwidth=10)) +
    theme_void() + theme(legend.position="top",legend.box="vertical")
```

## Avoidance Area Recipients

**Definition**: Avoidance area recipients indicates the amount of <a href="" title="Genes, Organisms, Nutrients, Energy">GONE</a> arriving into planning units from the avoidance area.

**Objectives**: Prioritize planning units which are least subsidized by the avoidance area (e.g. avoid connectivity for invasive species hot-spots).

**Equation**: The avoidance area recipients of a planning unit ${v}$ (${AAR(v)}$) in a graph ${G:=(V,E)}$ with ${V}$ vertices (*i.e.* planning units) and ${E}$ edges (*i.e.* connections), let ${C=(c_{v,t})}$ be the connectivity (probability) matrix.

$${\displaystyle AAR(v) = \sum_{t \ne v \in V(AA)}c_{t,v}N_t}$$

where ${N_t}$ is the amount of <a href="" title="Genes, Organisms, Nutrients, Energy">GONE</a> produced in planning unit ${t}$ and ${V(AA)}$ are the ${V}$ which spatially overlap with the avoidance area.

**Illustration**

```{r,message=FALSE, warning=FALSE, echo=FALSE, fig.width=5, fig.height = 6}
PU <- LETTERS[1:5]
AdjacencyMatrix <- matrix(data = c(0,0,0,0.01,0,
                                   0.1,0,0,0,0.1,
                                   0.01,0.05,0,0.01,0.01,
                                   0,0.01,0,0,0.05,
                                   0,0.1,0,0.1,0),
                          nrow = 5,
                          ncol = 5,
                          dimnames = list(PU,PU))

G <- graph_from_adjacency_matrix(AdjacencyMatrix, weighted=TRUE)
V(G)$type <- c("Planning Unit","Focus Area","Planning Unit","Focus Area","Planning Unit")

V(G)$metric <- colSums(AdjacencyMatrix[V(G)$type=="Focus Area",])

ggraph(as_tbl_graph(G),layout="fr") + 
    geom_edge_fan(aes(colour=weight,alpha = ..index..), start_cap = circle(4, 'mm'), end_cap = circle(4, 'mm'), edge_width = 1.25) + 
    scale_edge_colour_gradientn("Weight",colours=brewer.pal(5,"PuRd"),guide = guide_edge_colourbar(barwidth = 10))+
    scale_edge_alpha('Edge direction', guide = 'edge_direction') +
    geom_node_point(aes(colour = metric,shape=type),size = 8) + 
    scale_shape(name="")+
    scale_colour_gradientn(name="Focus Area Recipient", colours = brewer.pal(5,"YlGnBu"),guide = guide_colorbar(barwidth=10)) +
    theme_void() + theme(legend.position="top",legend.box="vertical")
```

## Avoidance Area Donors

**Definition**: Avoidance area donors indicates the amount of <a href="" title="Genes, Organisms, Nutrients, Energy">GONE</a> arriving into the avoidance area from planning units.

**Objectives**: Prioritize planning units which subsidize the avoidance area (e.g. increase resilience for impacted zones).

**Equation**: The avoidance area donors of a planning unit ${v}$ (${FAD(v)}$) in a graph ${G:=(V,E)}$ with ${V}$ vertices (*i.e.* planning units) and ${E}$ edges (*i.e.* connections), let ${C=(c_{v,t})}$ be the connectivity (probability) matrix.

$${\displaystyle AAD(v) = \sum_{t \ne v \in V(AA)}c_{v,t}N_v}$$

where ${N_v}$ is the amount of <a href="" title="Genes, Organisms, Nutrients, Energy">GONE</a> produced in planning unit ${v}$ and ${V(FA)}$ are the ${V}$ which spatially overlap with the avoidance area.

**Illustration**

```{r,message=FALSE, warning=FALSE, echo=FALSE, fig.width=5, fig.height = 6}
PU <- LETTERS[1:5]
AdjacencyMatrix <- matrix(data = c(0,0,0,0.01,0,
                                   0.1,0,0,0,0.1,
                                   0.01,0.05,0,0.01,0.01,
                                   0,0.01,0,0,0.05,
                                   0,0.1,0,0.1,0),
                          nrow = 5,
                          ncol = 5,
                          dimnames = list(PU,PU))

G <- graph_from_adjacency_matrix(AdjacencyMatrix, weighted=TRUE)
V(G)$type <- c("Planning Unit","Avoidance Area","Planning Unit","Avoidance Area","Planning Unit")

V(G)$metric <- rowSums(AdjacencyMatrix[,V(G)$type=="Avoidance Area"])

ggraph(as_tbl_graph(G),layout="fr") + 
    geom_edge_fan(aes(colour=weight,alpha = ..index..), start_cap = circle(4, 'mm'), end_cap = circle(4, 'mm'), edge_width = 1.25) + 
    scale_edge_colour_gradientn("Weight",colours=brewer.pal(5,"PuRd"),guide = guide_edge_colourbar(barwidth = 10))+
    scale_edge_alpha('Edge direction', guide = 'edge_direction') +
    geom_node_point(aes(colour = metric,shape=type),size = 8) + 
    scale_shape(name="")+
    scale_colour_gradientn(name="Avoidance Area Donors", colours = brewer.pal(5,"YlGnBu"),guide = guide_colorbar(barwidth=10)) +
    theme_void() + theme(legend.position="top",legend.box="vertical")
```


# Focus Areas

For some of the connectivity metrics (e.g. Temporal Connectivity Correlation, or Focus Area Donors), it is important to consider 'focus areas' for which connectivity should be optimized. Examples of such focus areas are existing protected areas, critical habitat for endangered species, and/or otherwise important habitats for connectivity (e.g. nursery grounds, genetically unique and potentially adaptively advantageous populations). Marxan Connect assumes that the planning units within the focus areas will otherwise be protected. Loading focus areas into Marxan Connect allows users to set conservation targets for other areas that complement focus areas, or to "lock-in" (fixed in the final reserve) the planning units which are overlap the focus area.

# Local Production

The amount of <a href="" title="Genes, Organisms, Nutrients, Energy">GONE</a> produced in each planning unit

# Resistance Matrix

Contains habitat specific values for resistance to movement through this habitat. Home habitat IDs are in the first column and IDs for habitats through which movement may occur are in the first row.

|     |   Sand   |   Boulder   |   Cobble   |   Mud   |  ...  |
|:---:|:-----:|:-----:|:-----:|:-----:|:-----:|
|**Sand**|  1  |  30 | 15 |  2 |  ...  |
|**Boulder**| 30 |  1  | 2 | 30 |  ...  |
|**Cobble**|  15 | 2 |  1 |  12 |  ...  |
|**Mud**| 2 | 30 | 12 |  1  |  ...  |
| ... |  ...  |  ...  |  ...  |  ...  |  ...  |

# Planning Units

Spatial sub-units of the entire planning area. Can be gridded (*e.g.* hexagonal) or feature based (e.g. reefs) as in Marxan.

# Shapefile

A popular geospatial data format by [esri](esri.com) (e.g. ArcGIS), but is supported by many open source GIS (e.g. QGIS) and statistical programming languages (e.g. R, Python)

# References
